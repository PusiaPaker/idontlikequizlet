{{define "edit"}}
  {{template "base" .}}
{{end}}

{{define "title"}}Edit{{end}}

{{define "content"}}
<div class="container py-4 max-md">

  <div class="mb-4">
    <a href="/deck/{{.DeckID}}" class="btn btn-outline-secondary d-inline-flex align-items-center gap-1">
      <i class="bi bi-arrow-left"></i>
      Return
    </a>
  </div>

  {{if .Cards}}
  <div class="edit-list">
    {{range $i, $c := .Cards}}
    <div class="edit-card border rounded-3 mb-4 p-4 shadow-sm">

      <!-- Top section: Term + Image -->
      <div class="row g-4 align-items-start">
        <!-- Term -->
        <div class="col-md-7">
          <label for="term-{{$i}}" class="form-label fw-semibold">Term</label>
          <input
            type="text"
            class="form-control mb-3 card-term"
            id="term-{{$i}}"
            name="term[]"
            data-card-id="{{ $c.ID }}"
            data-deck-id="{{ $.DeckID }}"
            placeholder="Enter term..."
            value="{{ $c.Term }}"
          >
        </div>

        <!-- Image placeholder -->
        <div class="col-md-5">
          <label class="form-label fw-semibold d-flex justify-content-between">
            Image
            <span class="text-muted small">optional</span>
          </label>
          <button
            type="button"
            class="image-slot w-100 border border-2 border-secondary-subtle bg-light-subtle"
            title="Add image (coming soon)"
          >
            <div class="image-slot-inner">
              <span class="image-plus">+</span>
              <span class="image-text">Add Image</span>
            </div>
          </button>
        </div>
      </div>

      <!-- Definition -->
      <div class="mt-4">
        <label for="def-{{$i}}" class="form-label fw-semibold">Definition</label>
        <textarea
          class="form-control card-def"
          id="def-{{$i}}"
          name="definition[]"
          rows="5"
          data-card-id="{{ $c.ID }}"
          data-deck-id="{{ $.DeckID }}"
          placeholder="Enter definition..."
        >{{- $c.Definition -}}
        </textarea>
      </div>

      <!-- Delete button -->
      <div class="d-flex justify-content-end mt-4">
        <button 
          type="button" 
          class="btn btn-outline-danger px-4 fw-semibold delete-btn" 
          data-card-id="{{ $c.ID }}"
          data-deck-id="{{ $.DeckID }}"
          >
          DELETE
        </button>

      </div>

    </div>
    {{end}}
  </div>
  {{else}}
  <p>No cards found for this deck.</p>
  {{end}}
  <div class="d-flex justify-content-center">
    <a
      href="/deck/{{.DeckID}}"
      class="btn btn-primary px-4 fw-semibold"
      title="Done"
    >
        Done
  </a>
  </div>
</div>
<script src="/static/js/updateCard.js"></script>
<script src="/static/js/deleteCard.js"></script>
<style>
  .max-md { max-width: 720px; margin-inline: auto; }
  .edit-list { display: flex; flex-direction: column; gap: 1.25rem; }
  .edit-card { background: var(--bs-body-bg); transition: box-shadow .15s ease, transform .15s ease; }
  .edit-card:hover { box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,0.06); transform: translateY(-2px); }

  /* image placeholder */
  .image-slot {
    aspect-ratio: 4 / 3;
    border-style: dashed !important;
    border-radius: 0.75rem;
    overflow: hidden;
    transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;
  }
  .image-slot:hover {
    transform: translateY(-1px);
    background-color: var(--bs-light);
  }
  .image-slot-inner {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: var(--bs-secondary);
    gap: .25rem;
  }
  .image-plus { font-size: 2rem; font-weight: bold; line-height: 1; }
  .image-text { font-size: 0.95rem; font-weight: 600; }

  /* green border briefly on success, red on failure */
  .is-valid { border-color: #198754 !important; }
  .is-invalid { border-color: #dc3545 !important; }


  /* responsive tweaks */
  @media (max-width: 768px) {
    .image-slot { aspect-ratio: 1.2 / 1; } /* slightly shorter on mobile */
  }
</style>
{{end}}
